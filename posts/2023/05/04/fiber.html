<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React Fiber到底是啥？ | 维维梓的博客 ｜ WeiS Blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/logo.png">
    <meta name="description" content="个人博客">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.f8d19f53.css" as="style"><link rel="preload" href="/assets/js/app.7b77c2c0.js" as="script"><link rel="preload" href="/assets/js/6.c637be34.js" as="script"><link rel="preload" href="/assets/js/14.91cadf63.js" as="script"><link rel="prefetch" href="/assets/js/10.0b5928ed.js"><link rel="prefetch" href="/assets/js/11.5fb46a50.js"><link rel="prefetch" href="/assets/js/12.fb57822d.js"><link rel="prefetch" href="/assets/js/13.2515b1db.js"><link rel="prefetch" href="/assets/js/15.c23ba4c7.js"><link rel="prefetch" href="/assets/js/16.51dd775e.js"><link rel="prefetch" href="/assets/js/2.35a0a702.js"><link rel="prefetch" href="/assets/js/3.fc3cf85f.js"><link rel="prefetch" href="/assets/js/4.76b9324e.js"><link rel="prefetch" href="/assets/js/5.0175d747.js"><link rel="prefetch" href="/assets/js/7.f81a89ad.js"><link rel="prefetch" href="/assets/js/8.693ba13f.js"><link rel="prefetch" href="/assets/js/9.5834a689.js">
    <link rel="stylesheet" href="/assets/css/0.styles.f8d19f53.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="global-layout" data-v-7f2e4136><header class="header-container" data-v-93921ff8 data-v-7f2e4136><nav class="navbar" style="position:absolute;opacity:1;transition:all 0.5s ease-in-out;" data-v-93921ff8><a href="/" class="navbar-link router-link-active">
    WeiS Blog
  </a> <ul class="navbar-links"><li><a href="/" class="router-link-active">
        HOME
      </a></li><li><a href="/about/">
        ABOUT
      </a></li><li><a href="/tags/">
        TAGS
      </a></li></ul> <div id="nav-icon"><span></span><span></span><span></span></div></nav> <div class="header-title" data-v-93921ff8 data-v-93921ff8><h1 data-v-93921ff8>React Fiber到底是啥？</h1> <p data-v-93921ff8>有几种含义来着</p></div></header> <div class="container" data-v-b3fda33c data-v-7f2e4136><main class="main" style="width:60%;" data-v-b3fda33c><div class="post" data-v-b3fda33c data-v-b3fda33c><article class="main-div"><div class="post-content content content__default"><p>了解了解React Fiber的起源和架构，为后续的源码阅读做准备！
</p> <h1 id="react-fiber"><a href="#react-fiber" class="header-anchor">#</a> React Fiber</h1> <p>在React15中，有虚拟DOM这样一个概念，负责视图，而<strong>Reconciler</strong>在对虚拟DOM树做diff算法的时候不允许外界打断的，这是一个递归的过程，而fiber的提出就很好的解决了这个问题。</p> <p>在React16中，虚拟DOM有个正式的称呼——<code>Fiber</code>，不再是曾经用于递归的虚拟DOM数据结构了。</p> <h3 id="fiber的目标"><a href="#fiber的目标" class="header-anchor">#</a> Fiber的目标</h3> <p>为了满足React16的<strong>Scheduler</strong>调度，核心概念就是可以随心所欲的控制我们的代码，具体来说则是：</p> <ul><li>可以暂停工作，稍后再回来</li> <li>为不同类型工作分配优先级</li> <li>重用之前完成的工作</li> <li>如果不再需要，则中止工作</li></ul> <h3 id="fiber是什么"><a href="#fiber是什么" class="header-anchor">#</a> Fiber是什么</h3> <p>Fiber的含义有几种：</p> <ol><li>可以理解为一种架构，也就是常说的<code>FIber树</code>。实现了“双缓存技术”；</li> <li>本质上可以理解为一种数据结构，是个最小的工作单元，每一个Fiber节点都对应一个 React element，保存了对应的DOM节点信息，大量的Fiber节点组成了一个链表，这是虚拟DOM树的另外一种表示。</li></ol> <h3 id="fiber作为架构的工作原理"><a href="#fiber作为架构的工作原理" class="header-anchor">#</a> Fiber作为架构的工作原理</h3> <p>就像前面提到的那样，<code>React</code>使用“双缓存技术”来完成<code>Fiber树</code>的构建和替换，对应着的就是DOM树的创建与更新。</p> <blockquote><p><strong>在内存中构建并直接替换</strong>的技术叫做<a href="https://baike.baidu.com/item/%E5%8F%8C%E7%BC%93%E5%86%B2" target="_blank" rel="noopener noreferrer">双缓存<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>在React中最多会同时存在两棵<code>Fiber树</code>：</p> <ul><li><p>当前屏幕上显示内容对应的<code>Fiber树</code>称为<code>current Fiber树</code></p></li> <li><p>正在内存中构建的<code>Fiber树</code>称为<code>workInProgress Fiber树</code>。</p></li></ul> <p>两棵树对应着两种不同的节点：</p> <ul><li><code>current Fiber树</code>中的<code>Fiber节点</code>被称为`current fiber``</li> <li>``workInProgress Fiber树<code>中的</code>Fiber节点<code>被称为</code>workInProgress fiber`</li> <li>他们通过<code>alternate</code>属性连接。</li></ul> <p>替换原理：</p> <p><code>React</code>应用的根节点通过使<code>current</code>指针在不同<code>Fiber树</code>的<code>rootFiber</code>间切换来完成<code>current Fiber</code>树指向的切换。</p> <p>即当<code>workInProgress Fiber树</code>构建完成交给<code>Renderer</code>渲染在页面上后，应用根节点的<code>current</code>指针指向<code>workInProgress Fiber树</code>，此时<code>workInProgress Fiber树</code>就变为<code>current Fiber树</code>。</p> <p>每次状态更新都会产生新的<code>workInProgress Fiber树</code>，通过<code>current</code>与<code>workInProgress</code>的替换，完成<code>DOM</code>更新。</p> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>了解了Fiber的起源与架构，Fiber节点，链表结构，存储DOM信息，可以构成Fiber树，而Fiber树又通过双缓存技术进行替换和更新。</p></div></article> <!----></div></main> <aside class="aside" data-v-b3fda33c data-v-b3fda33c><div class="info-card main-div" data-v-1311ce9e data-v-b3fda33c><div class="info-card-header" data-v-1311ce9e><img src="/avatar.jpg" alt="维维梓" class="info-avatar" data-v-1311ce9e></div> <div class="info-card-body" data-v-1311ce9e><section class="info-name" data-v-1311ce9e>
      维维梓
    </section> <section class="info-desc" data-v-1311ce9e>一个爱说唱的程序员</section> <section class="info-contact" data-v-1311ce9e><section data-v-1311ce9e><span data-v-1311ce9e data-v-1311ce9e><svg class="icon" style="font-size:1em;" data-v-1311ce9e data-v-1311ce9e><use xlink:href="#icon-location" data-v-1311ce9e data-v-1311ce9e></use></svg><span class="info-text" data-v-1311ce9e data-v-1311ce9e>
          Shanghai, China
        </span></span></section> <!----> <section data-v-1311ce9e><span data-v-1311ce9e data-v-1311ce9e><svg class="icon" style="font-size:1em;" data-v-1311ce9e data-v-1311ce9e><use xlink:href="#icon-email" data-v-1311ce9e data-v-1311ce9e></use></svg><span class="info-text" data-v-1311ce9e data-v-1311ce9e>
          2201553139@qq.com
        </span></span></section></section></div> <div class="info-card-footer" data-v-1311ce9e><p class="footer-sns-link" data-v-1311ce9e><a target="_blank" href="https://github.com/QinZiWeiS" class="sns-link" data-v-1311ce9e><span class="sns-icon" data-v-1311ce9e data-v-1311ce9e><svg class="icon" style="font-size:35px;" data-v-1311ce9e data-v-1311ce9e><use xlink:href="#icon-github" data-v-1311ce9e data-v-1311ce9e></use></svg></span></a></p></div></div> <div class="post-toc main-div aside-toc" style="position:relative;top:0;width:0px;" data-v-b3fda33c><h4>- CATALOG</h4> <div class="post-nav-toc"><ul><li><a href="/posts/2023/05/04/fiber.html#fiber的目标">Fiber的目标</a><ul><li><a href="/posts/2023/05/04/fiber.html#fiber是什么">Fiber是什么</a></li><li><a href="/posts/2023/05/04/fiber.html#fiber作为架构的工作原理">Fiber作为架构的工作原理</a></li><li><a href="/posts/2023/05/04/fiber.html#总结">总结</a></li></ul></li></ul></div></div></aside></div> <footer class="footer" data-v-7f2e4136><p class="footer-sns-link"><a target="_blank" href="https://github.com/QinZiWeiS" class="sns-link"><span class="sns-icon"><svg class="icon" style="font-size:40px;"><use xlink:href="#icon-github"></use></svg></span></a></p> <div class="copyright"><span id="custom">Copyright &copy; WeiS Blog 2023</span> <!----></div></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.7b77c2c0.js" defer></script><script src="/assets/js/6.c637be34.js" defer></script><script src="/assets/js/14.91cadf63.js" defer></script>
  </body>
</html>
