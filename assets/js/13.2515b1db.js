(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{456:function(e,r,_){"use strict";_.r(r);var t=_(1),v=Object(t.a)({},(function(){var e=this,r=e._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("p",[e._v("React15到React16就是为了更好的实现React的理念——"),r("strong",[e._v("快速响应")]),e._v("。必须要做到：可中断！\n")]),e._v(" "),r("h1",{attrs:{id:"react-15-到-react-16"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#react-15-到-react-16"}},[e._v("#")]),e._v(" React 15 到 React 16")]),e._v(" "),r("p",[e._v("之前已经了解到了React的理念就是"),r("strong",[e._v("快速响应")]),e._v("，而React16的由来就是因为React15并不能很好的满足"),r("strong",[e._v("快速响应")]),e._v("的理念，所以我们先来看看React15的缺点。")]),e._v(" "),r("h3",{attrs:{id:"老的react15架构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#老的react15架构"}},[e._v("#")]),e._v(" 老的React15架构")]),e._v(" "),r("p",[e._v("React15架构可以分为两层：")]),e._v(" "),r("ul",[r("li",[e._v("Reconciler（协调器）—— 负责找出变化的组件")]),e._v(" "),r("li",[e._v("Renderer（渲染器）—— 负责将变化的组件渲染到页面上")])]),e._v(" "),r("h4",{attrs:{id:"_1-reconciler-协调器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-reconciler-协调器"}},[e._v("#")]),e._v(" 1.Reconciler(协调器)")]),e._v(" "),r("p",[e._v("每当有更新发生时，"),r("strong",[e._v("Reconciler")]),e._v("会做如下工作：")]),e._v(" "),r("ul",[r("li",[e._v("调用函数组件、或class组件的"),r("code",[e._v("render")]),e._v("方法，将返回的JSX转化为虚拟DOM")]),e._v(" "),r("li",[e._v("将虚拟DOM和上次更新时的虚拟DOM对比")]),e._v(" "),r("li",[e._v("通过对比找出本次更新中变化的虚拟DOM")]),e._v(" "),r("li",[e._v("通知"),r("strong",[e._v("Renderer")]),e._v("将变化的虚拟DOM渲染到页面上")])]),e._v(" "),r("h4",{attrs:{id:"_2-renderer-渲染器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-renderer-渲染器"}},[e._v("#")]),e._v(" 2.Renderer（渲染器）")]),e._v(" "),r("p",[e._v("不同平台有不同的"),r("strong",[e._v("Renderer")]),e._v("。我们前端最熟悉的是负责在浏览器环境渲染的"),r("strong",[e._v("Renderer")]),e._v(" —— "),r("a",{attrs:{href:"https://www.npmjs.com/package/react-dom",target:"_blank",rel:"noopener noreferrer"}},[e._v("ReactDOM"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("而"),r("strong",[e._v("Renderer")]),e._v("的作用就是在每次更新发生时，"),r("strong",[e._v("Renderer")]),e._v("接到"),r("strong",[e._v("Reconciler")]),e._v("通知，将变化的组件渲染在当前的环境。")]),e._v(" "),r("h4",{attrs:{id:"_3-react15架构的缺点"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-react15架构的缺点"}},[e._v("#")]),e._v(" 3.React15架构的缺点")]),e._v(" "),r("p",[e._v("React15的架构是通过"),r("strong",[e._v("递归更新")]),e._v("来实现的，挂载的组件调用"),r("strong",[e._v("mountComponent")]),e._v("，更新的组件调用"),r("strong",[e._v("updateComponent")]),e._v("，这两个方法都会递归更新子组件，那这样的递归更新是无法中断的，并且"),r("strong",[e._v("Reconciler")]),e._v("和"),r("strong",[e._v("Renderer")]),e._v("是交替工作的，违背了刚刚我们所说的"),r("code",[e._v("React")]),e._v("解决"),r("strong",[e._v("快速响应")]),e._v("的方法——用"),r("strong",[e._v("可中断")]),e._v("的异步更新代替同步的更新，具体可以看"),r("a",{attrs:{href:"https://qinziweis.github.io/posts/2023/04/04/react.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("React理念"),r("OutboundLink")],1),e._v("这一篇，于是乎"),r("code",[e._v("React")]),e._v("重写了整个架构")]),e._v(" "),r("h3",{attrs:{id:"新的react16架构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#新的react16架构"}},[e._v("#")]),e._v(" 新的React16架构")]),e._v(" "),r("p",[e._v("React16架构可以分为三层：")]),e._v(" "),r("ul",[r("li",[e._v("Scheduler（调度器）—— 调度任务的优先级，高优任务优先进入"),r("strong",[e._v("Reconciler")])]),e._v(" "),r("li",[e._v("Reconciler（协调器）—— 负责找出变化的组件")]),e._v(" "),r("li",[e._v("Renderer（渲染器）—— 负责将变化的组件渲染到页面上")])]),e._v(" "),r("p",[e._v("可以看到，相较于React15，React16中新增了"),r("strong",[e._v("Scheduler（调度器）")]),e._v("，让我们来了解下他。")]),e._v(" "),r("h4",{attrs:{id:"_1-scheduler-调度器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-scheduler-调度器"}},[e._v("#")]),e._v(" 1. Scheduler（调度器）")]),e._v(" "),r("p",[e._v("既然我们以浏览器是否有剩余时间作为任务中断的标准，那么我们需要一种机制，当浏览器有剩余时间时通知我们。")]),e._v(" "),r("p",[r("strong",[e._v("Scheduler")]),e._v("会接收需要更新的任务，在浏览器有剩余时间时触发回调，并且提供了多种调度优先级，可以设置给任务。高优先级的任务可以随时打断正在进行中的低优先级任务。")]),e._v(" "),r("h4",{attrs:{id:"_2-reconciler-协调器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-reconciler-协调器"}},[e._v("#")]),e._v(" 2.Reconciler（协调器）")]),e._v(" "),r("p",[e._v("我们知道，在React15中"),r("strong",[e._v("Reconciler")]),e._v("是递归处理虚拟DOM的。而React16中，更新工作从递归变成了可以中断的循环过程。每次循环都会调用"),r("code",[e._v("shouldYield")]),e._v("判断当前是否有剩余时间。")]),e._v(" "),r("p",[e._v("那么如果中断更新时，DOM渲染不完全呢?这会导致页面出现异常。")]),e._v(" "),r("p",[e._v("所以React16中的"),r("strong",[e._v("Reconciler")]),e._v("和"),r("strong",[e._v("Renderer")]),e._v("不再是交替工作了，而是"),r("strong",[e._v("Scheduler")]),e._v("江任务交给"),r("strong",[e._v("Reconciler")]),e._v("后，"),r("strong",[e._v("Reconciler")]),e._v("会为这些变化的虚拟DOM打上某个代表操作类型（增删改）的标记，将所有的组件都完成"),r("strong",[e._v("Reconciler")]),e._v("的工作后，将统一交给"),r("strong",[e._v("Renderer")]),e._v("去渲染")]),e._v(" "),r("h4",{attrs:{id:"_3-renderer-渲染器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-renderer-渲染器"}},[e._v("#")]),e._v(" 3.Renderer（渲染器）")]),e._v(" "),r("p",[r("strong",[e._v("Renderer")]),e._v("根据"),r("strong",[e._v("Reconciler")]),e._v("为虚拟DOM打的标记，同步执行对应的DOM操作。")]),e._v(" "),r("h3",{attrs:{id:"总结"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[e._v("#")]),e._v(" 总结")]),e._v(" "),r("p",[e._v("总的来说，React15->React16发生的变化就是如下：")]),e._v(" "),r("ul",[r("li",[e._v("新增"),r("strong",[e._v("Scheduler")]),e._v("，负责监听需要完成的任务，并且有了优先级，高优先级任务打断低优先级任务")]),e._v(" "),r("li",[e._v("不再是交替着工作，而是"),r("strong",[e._v("Reconciler")]),e._v("根据"),r("strong",[e._v("Scheduler")]),e._v("的任务进行判断，将所有需要更改的虚拟DOM全找出来之后，再统一交给"),r("strong",[e._v("Renderer")])]),e._v(" "),r("li",[e._v("不再是递归更新，导致无法中断。"),r("strong",[e._v("Scheduler")]),e._v("和"),r("strong",[e._v("Reconciler")]),e._v("的工作随时都可以中断，并且因为"),r("strong",[e._v("Renderer")]),e._v("并没有收到要更新的消息，页面也不会有异常变化。")])])])}),[],!1,null,null,null);r.default=v.exports}}]);